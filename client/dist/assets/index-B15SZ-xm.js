import{c as be,r as o,u as U,a as M,j as e,C as Z,B as D,T as b,b as w,F as z,d as j,e as ve,G as v,L as re,f as ae,g as A,I as Y,S as J,M as R,h as Ce,D as I,i as W,k as O,l as q,m as G,A as Se,n as ne,P as T,o as oe,p as le,q as F,s as c,t as ie,v as H,E as we,w as ye,x as Ae,y as De,z as Le,H as Re,J as Pe,K as Ee,N as ke,O as Te,Q as _e,R as K,U as Be,V as Ne,W as Ie,X as k,Y as We,Z as Oe,_ as qe,$ as $e}from"./vendor-qcbvkQxJ.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();const ze={user:null,token:null,isAuthenticated:!1,loading:!1,error:null},ce=be({name:"auth",initialState:ze,reducers:{loginStart(t){t.loading=!0,t.error=null},loginSuccess(t,r){t.user=r.payload.user,t.token=r.payload.token,t.isAuthenticated=!0,t.loading=!1,t.error=null},loginFailure(t,r){t.loading=!1,t.error=r.payload},logout(t){t.user=null,t.token=null,t.isAuthenticated=!1}}}),{loginStart:Fe,loginSuccess:de,loginFailure:Ue,logout:Me}=ce.actions,Ze=ce.reducer,Ge=()=>{const[t,r]=o.useState(""),[a,i]=o.useState(""),[n,l]=o.useState(""),g=U(),C=M(),P=async x=>{var d,m;x.preventDefault(),g(Fe());try{const p=await A.post("http://localhost:5000/api/auth/login",{email:t,password:a});g(de(p.data)),C(p.data.user.role==="admin"?"/dashboard":"/telecaller")}catch(p){const u=((m=(d=p.response)==null?void 0:d.data)==null?void 0:m.message)||"Invalid credentials, try again";g(Ue(u)),l("Invalid credentials, try again")}};return e.jsx(Z,{maxWidth:"xs",children:e.jsxs(D,{sx:{mt:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(b,{component:"h1",variant:"h5",children:"Sign in"}),e.jsxs(D,{component:"form",onSubmit:P,sx:{mt:1},children:[e.jsx(w,{margin:"normal",required:!0,fullWidth:!0,label:"Email Address",autoComplete:"email",autoFocus:!0,value:t,onChange:x=>r(x.target.value)}),e.jsx(w,{margin:"normal",required:!0,fullWidth:!0,label:"Password",type:"password",autoComplete:"current-password",value:a,onChange:x=>i(x.target.value)}),e.jsxs(z,{fullWidth:!0,error:!!n,sx:{mt:2},children:[e.jsx(j,{type:"submit",fullWidth:!0,variant:"contained",sx:{mb:1},children:"Sign In"}),n&&e.jsx(ve,{children:n})]}),e.jsx(v,{container:!0,justifyContent:"center",sx:{mt:2},children:e.jsx(v,{item:!0,xs:!0,children:e.jsx(re,{component:ae,to:"/signup",variant:"body2",children:"Don't have an account? Sign Up"})})})]})]})})},He=()=>{const[t,r]=o.useState({name:"",email:"",password:"",confirmPassword:"",role:"telecaller"}),[a,i]=o.useState({}),[n,l]=o.useState(!1),[g,C]=o.useState(!1);U();const P=M(),x=u=>{const{name:h,value:y}=u.target;r(L=>({...L,[h]:y}))},d=()=>{const u={};return t.name.trim()||(u.name="Name is required"),t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(u.email="Email is invalid"):u.email="Email is required",t.password?t.password.length<6&&(u.password="Password must be at least 6 characters"):u.password="Password is required",t.password!==t.confirmPassword&&(u.confirmPassword="Passwords do not match"),i(u),Object.keys(u).length===0},m=async u=>{var h,y;if(u.preventDefault(),!!d()){C(!0);try{const{confirmPassword:L,...$}=t,f=await A.post("http://localhost:5000/api/auth/signup",$);l(!0)}catch(L){console.error("Signup error:",L),i({...a,form:((y=(h=L.response)==null?void 0:h.data)==null?void 0:y.message)||"Signup failed. Please try again."})}finally{C(!1)}}},p=()=>{l(!1),P("/login")};return e.jsxs(Z,{maxWidth:"sm",children:[e.jsxs(D,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(b,{component:"h1",variant:"h5",children:"Sign Up"}),a.form&&e.jsx(b,{color:"error",sx:{mt:2},children:a.form}),e.jsxs(D,{component:"form",onSubmit:m,sx:{mt:3},children:[e.jsxs(v,{container:!0,spacing:2,children:[e.jsx(v,{item:!0,xs:12,children:e.jsx(w,{autoComplete:"name",name:"name",required:!0,fullWidth:!0,id:"name",label:"Full Name",autoFocus:!0,value:t.name,onChange:x,error:!!a.name,helperText:a.name})}),e.jsx(v,{item:!0,xs:12,children:e.jsx(w,{required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",value:t.email,onChange:x,error:!!a.email,helperText:a.email})}),e.jsx(v,{item:!0,xs:12,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(Y,{id:"role-label",children:"Role"}),e.jsxs(J,{labelId:"role-label",id:"role",name:"role",value:t.role,label:"Role",onChange:x,children:[e.jsx(R,{value:"telecaller",children:"Telecaller"}),e.jsx(R,{value:"admin",children:"Admin"})]})]})}),e.jsx(v,{item:!0,xs:12,children:e.jsx(w,{required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"new-password",value:t.password,onChange:x,error:!!a.password,helperText:a.password})}),e.jsx(v,{item:!0,xs:12,children:e.jsx(w,{required:!0,fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:"password",id:"confirmPassword",value:t.confirmPassword,onChange:x,error:!!a.confirmPassword,helperText:a.confirmPassword})})]}),e.jsx(j,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:g,children:g?e.jsx(Ce,{size:24}):"Sign Up"}),e.jsx(v,{container:!0,justifyContent:"center",sx:{mt:2},children:e.jsx(v,{item:!0,children:e.jsx(re,{component:ae,to:"/login",variant:"body2",children:"Already have an account? Sign in"})})})]})]}),e.jsxs(I,{open:n,onClose:p,children:[e.jsx(W,{children:"Signup Successful!"}),e.jsx(O,{children:"Your account has been created successfully. You can now login with your credentials."}),e.jsx(q,{children:e.jsx(j,{onClick:p,color:"primary",children:"Go to Login"})})]})]})},Ye=()=>{const{user:t,token:r}=G(s=>s.auth),[a,i]=o.useState([]),[n,l]=o.useState(!1),[g,C]=o.useState(!1),[P,x]=o.useState(!1),[d,m]=o.useState(!1),[p,u]=o.useState(null),[h,y]=o.useState({name:"",email:"",phone:"",address:""}),[L,$]=o.useState(""),[f,_]=o.useState(""),[B,E]=o.useState(""),[Q,V]=o.useState(""),[X,ee]=o.useState("");o.useEffect(()=>{(async()=>{try{const{data:S}=await A.get("http://localhost:5000/api/leads",{headers:{Authorization:`Bearer ${r}`}});i(S)}catch(S){console.error("Error fetching leads:",S)}})()},[r]);const ue=s=>/^\d{10}$/.test(s)?(V(""),!0):(V("Phone number must be exactly 10 digits and contain only numbers"),!1),he=s=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s)?(ee(""),!0):(ee("Please enter a valid email address"),!1),xe=async()=>{if(!(!ue(h.phone)||!he(h.email)))try{const{data:s}=await A.post("http://localhost:5000/api/leads",{...h,telecaller:t.id},{headers:{Authorization:`Bearer ${r}`}});i([...a,s]),l(!1),y({name:"",email:"",phone:"",address:""})}catch(s){console.error("Error adding lead:",s)}},pe=async()=>{try{const{data:s}=await A.put(`http://localhost:5000/api/leads/${p._id}/address`,{address:L},{headers:{Authorization:`Bearer ${r}`}});i(a.map(S=>S._id===s._id?s:S)),C(!1)}catch(s){console.error("Error updating address:",s)}},me=async()=>{var s,S;try{if(!f){console.error("Status is required");return}if((f==="connected"||f==="not_connected")&&!B){console.error("Response is required for this status");return}const{data:N}=await A.put(`http://localhost:5000/api/leads/${p._id}/status`,{status:f,response:f==="new"?null:B},{headers:{Authorization:`Bearer ${r}`}});i(a.map(se=>se._id===N._id?N:se)),x(!1),_(""),E("")}catch(N){console.error("Error updating status:",((S=(s=N.response)==null?void 0:s.data)==null?void 0:S.message)||N.message)}},je=async()=>{try{await A.delete(`http://localhost:5000/api/leads/${p._id}`,{headers:{Authorization:`Bearer ${r}`}}),i(a.filter(s=>s._id!==p._id)),m(!1)}catch(s){console.error("Error deleting lead:",s)}},ge=s=>{switch(s){case"new":return"New";case"connected":return"Connected";case"not_connected":return"Not Connected";default:return s}},fe=s=>{if(!s)return"N/A";switch(s){case"discussed":return"Discussed";case"callback":return"Callback";case"interested":return"Interested";case"busy":return"Busy";case"rnr":return"RNR";case"switched_off":return"Switched Off";default:return s}};return e.jsxs(Z,{children:[e.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,marginRight:3,marginTop:1.7},children:[e.jsx(b,{variant:"h4",children:"Customer Leads"}),e.jsx(j,{variant:"contained",startIcon:e.jsx(Se,{}),onClick:()=>l(!0),children:"Add New"})]}),e.jsx(ne,{component:T,children:e.jsxs(oe,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Phone"}),e.jsx(c,{children:"Address"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Response"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ie,{children:a.map(s=>e.jsxs(F,{children:[e.jsx(c,{children:s.name}),e.jsx(c,{children:s.email}),e.jsx(c,{children:s.phone}),e.jsx(c,{children:s.address}),e.jsx(c,{children:ge(s.status)}),e.jsx(c,{children:fe(s.response)}),e.jsxs(c,{children:[e.jsx(H,{onClick:()=>{u(s),$(s.address),C(!0)},children:e.jsx(we,{})}),e.jsx(H,{onClick:()=>{u(s),_(s.status),E(s.response||""),x(!0)},children:e.jsx(b,{variant:"body2",sx:{color:"#C71585"},children:"Update Status"})}),e.jsx(H,{onClick:()=>{u(s),m(!0)},children:e.jsx(ye,{})})]})]},s._id))})]})}),e.jsxs(I,{open:n,onClose:()=>l(!1),children:[e.jsx(W,{children:"Add New Customer Lead"}),e.jsxs(O,{children:[e.jsx(w,{margin:"dense",label:"Name",fullWidth:!0,required:!0,value:h.name,onChange:s=>y({...h,name:s.target.value})}),e.jsx(w,{margin:"dense",label:"Email",fullWidth:!0,required:!0,type:"email",value:h.email,onChange:s=>y({...h,email:s.target.value}),error:!!X,helperText:X}),e.jsx(w,{margin:"dense",label:"Phone",fullWidth:!0,required:!0,value:h.phone,onChange:s=>y({...h,phone:s.target.value}),error:!!Q,helperText:Q}),e.jsx(w,{margin:"dense",label:"Address",fullWidth:!0,required:!0,value:h.address,onChange:s=>y({...h,address:s.target.value})})]}),e.jsxs(q,{children:[e.jsx(j,{onClick:()=>l(!1),children:"Cancel"}),e.jsx(j,{onClick:xe,disabled:!h.name||!h.email||!h.phone||!h.address,children:"Save"})]})]}),e.jsxs(I,{open:g,onClose:()=>C(!1),children:[e.jsx(W,{children:"Edit Address"}),e.jsx(O,{children:e.jsx(w,{margin:"dense",label:"Address",fullWidth:!0,value:L,onChange:s=>$(s.target.value)})}),e.jsxs(q,{children:[e.jsx(j,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(j,{onClick:pe,children:"Save"})]})]}),e.jsxs(I,{open:P,onClose:()=>x(!1),children:[e.jsx(W,{children:"Update Call Status"}),e.jsxs(O,{children:[e.jsxs(D,{sx:{mb:2,display:"flex",gap:1},children:[e.jsx(j,{variant:f==="new"?"contained":"outlined",onClick:()=>{_("new"),E("")},children:"New"}),e.jsx(j,{variant:f==="connected"?"contained":"outlined",onClick:()=>{_("connected"),E(p.status==="connected"?p.response:"")},children:"Connected"}),e.jsx(j,{variant:f==="not_connected"?"contained":"outlined",onClick:()=>{_("not_connected"),E(p.status==="not_connected"?p.response:"")},children:"Not Connected"})]}),f==="connected"&&e.jsxs(z,{fullWidth:!0,sx:{mt:2},children:[e.jsx(Y,{children:"Response"}),e.jsxs(J,{value:B,label:"Response",onChange:s=>E(s.target.value),children:[e.jsx(R,{value:"discussed",children:"Discussed"}),e.jsx(R,{value:"callback",children:"Callback"}),e.jsx(R,{value:"interested",children:"Interested"})]})]}),f==="not_connected"&&e.jsxs(z,{fullWidth:!0,sx:{mt:2},children:[e.jsx(Y,{children:"Response"}),e.jsxs(J,{value:B,label:"Response",onChange:s=>E(s.target.value),children:[e.jsx(R,{value:"busy",children:"Busy"}),e.jsx(R,{value:"rnr",children:"RNR (Ring No Response)"}),e.jsx(R,{value:"switched_off",children:"Switched Off"})]})]})]}),e.jsxs(q,{children:[e.jsx(j,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(j,{onClick:me,disabled:!f||(f==="connected"||f==="not_connected")&&!B,children:"Save"})]})]}),e.jsxs(I,{open:d,onClose:()=>m(!1),children:[e.jsx(W,{children:"Confirm Delete"}),e.jsx(O,{children:"Are you sure you want to delete this lead?"}),e.jsxs(q,{children:[e.jsx(j,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(j,{onClick:je,color:"error",children:"Delete"})]})]})]})};Ae.register(De,Le,Re,Pe,Ee,ke);const Je=()=>{const{token:t}=G(d=>d.auth),[r,a]=o.useState({totalTelecallers:0,totalLeads:0,connectedLeads:0}),[i,n]=o.useState([]),[l,g]=o.useState([]);o.useEffect(()=>{(async()=>{try{const m=await A.get("http://localhost:5000/api/dashboard/stats",{headers:{Authorization:`Bearer ${t}`}});a(m.data);const p=await A.get("http://localhost:5000/api/dashboard/trends",{headers:{Authorization:`Bearer ${t}`}});n(p.data);const u=await A.get("http://localhost:5000/api/dashboard/calls",{headers:{Authorization:`Bearer ${t}`}});g(u.data)}catch(m){console.error("Error fetching dashboard data:",m)}})()},[t]);const C={labels:i.map(d=>d._id),datasets:[{label:"Calls per Day",data:i.map(d=>d.count),backgroundColor:"rgba(75, 192, 192, 0.6)"}]},P={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Call Trends (Last 7 Days)"}}},x=d=>{switch(d){case"discussed":return"Discussed";case"callback":return"Callback";case"interested":return"Interested";case"busy":return"Busy";case"rnr":return"RNR";case"switched_off":return"Switched Off";default:return"N/A"}};return e.jsxs(Z,{children:[e.jsx(b,{variant:"h4",gutterBottom:!0,children:"Admin Dashboard"}),e.jsxs(v,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(v,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsx(b,{variant:"h6",children:"Total Telecallers"}),e.jsx(b,{variant:"h4",children:r.totalTelecallers})]})}),e.jsx(v,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsx(b,{variant:"h6",children:"Total Leads"}),e.jsx(b,{variant:"h4",children:r.totalLeads})]})}),e.jsx(v,{item:!0,xs:12,md:4,children:e.jsxs(T,{sx:{p:2},children:[e.jsx(b,{variant:"h6",children:"Connected Leads"}),e.jsx(b,{variant:"h4",children:r.connectedLeads})]})})]}),e.jsx(D,{sx:{mb:4},children:e.jsxs(T,{sx:{p:2},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Call Trends"}),e.jsx(D,{sx:{height:"300px"},children:e.jsx(Te,{data:C,options:P})})]})}),e.jsxs(T,{sx:{p:2},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Recent Connected Calls"}),e.jsx(ne,{children:e.jsxs(oe,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Telecaller"}),e.jsx(c,{children:"Date & Time"}),e.jsx(c,{children:"Response"})]})}),e.jsx(ie,{children:l.map(d=>{var m;return e.jsxs(F,{children:[e.jsx(c,{children:d.name}),e.jsx(c,{children:((m=d.telecaller)==null?void 0:m.name)||"N/A"}),e.jsx(c,{children:new Date(d.updatedAt).toLocaleString()}),e.jsx(c,{children:x(d.response)})]},d._id)})})]})})]})]})},te=({children:t,allowedRoles:r})=>{const{isAuthenticated:a,user:i}=G(l=>l.auth),n=_e();return a?r&&!r.includes(i.role)?e.jsx(K,{to:i.role==="admin"?"/dashboard":"/telecaller",replace:!0}):t:e.jsx(K,{to:"/login",state:{from:n},replace:!0})},Ke=()=>{const[t]=Be(),r=U(),a=M();return o.useEffect(()=>{const i=t.get("token");if(i){const n=JSON.parse(atob(i.split(".")[1]));r(de({token:i,user:n})),a(n.role==="admin"?"/dashboard":"/telecaller")}},[t,r,a]),e.jsx("div",{children:"Authenticating..."})},Qe=()=>{const t=U(),r=M(),a=()=>{t(Me()),r("/login")};return e.jsx(D,{sx:{position:"fixed",bottom:16,right:16,display:"flex",flexDirection:"column",gap:1,zIndex:1e3},children:e.jsx(j,{variant:"contained",color:"error",startIcon:e.jsx(Ne,{}),onClick:a,sx:{padding:"10px",borderRadius:"50%",boxShadow:3},children:"Logout"})})};function Ve(){const{isAuthenticated:t}=G(r=>r.auth);return e.jsxs("div",{className:"App",children:[t&&e.jsx(Qe,{}),e.jsxs(Ie,{children:[e.jsx(k,{path:"/login",element:e.jsx(Ge,{})}),e.jsx(k,{path:"/signup",element:e.jsx(He,{})}),e.jsx(k,{path:"/auth-success",element:e.jsx(Ke,{})}),e.jsx(k,{path:"/telecaller",element:e.jsx(te,{allowedRoles:["telecaller"],children:e.jsx(Ye,{})})}),e.jsx(k,{path:"/dashboard",element:e.jsx(te,{allowedRoles:["admin"],children:e.jsx(Je,{})})}),e.jsx(k,{path:"/",element:e.jsx(K,{to:"/login"})})]})]})}const Xe=We({reducer:{auth:Ze}}),es=document.getElementById("root"),ss=Oe.createRoot(es);ss.render(e.jsx(o.StrictMode,{children:e.jsxs(qe,{store:Xe,children:[" ",e.jsx($e,{children:e.jsx(Ve,{})})]})}));
